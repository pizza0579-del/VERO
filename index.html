<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Inventario Pneumatici</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK v9 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue, push, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // La TUA configurazione Firebase (gomme2)
        const firebaseConfig = {
            apiKey: "AIzaSyAuom2xB08c9EMEJF3qLC1dFR4sk9GtccY",
            authDomain: "gomme2.firebaseapp.com",
            databaseURL: "https://gomme2-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "gomme2",
            storageBucket: "gomme2.firebasestorage.app",
            messagingSenderId: "386566184650",
            appId: "1:386566184650:web:50fc2d56e5c326f5599e33"
        };

        // Inizializza Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        // Rendi disponibili globalmente
        window.firebaseApp = app;
        window.firebaseDB = database;
        window.firebaseAuth = auth;
        window.firebaseRefs = { ref, set, get, onValue, push, serverTimestamp };
        window.authFunctions = { signInAnonymously, onAuthStateChanged };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
        }
        
        .brand-logo {
            width: 60px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            border-radius: 6px;
            color: white;
        }
        
        .michelin { background: linear-gradient(135deg, #1e40af, #3b82f6); }
        .riken { background: linear-gradient(135deg, #dc2626, #ef4444); }
        .falken { background: linear-gradient(135deg, #059669, #10b981); }
        .sailun { background: linear-gradient(135deg, #7c3aed, #8b5cf6); }
        .continental { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
        .pirelli { background: linear-gradient(135deg, #1f2937, #374151); }
        .bridgestone { background: linear-gradient(135deg, #b91c1c, #dc2626); }
        .goodyear { background: linear-gradient(135deg, #0891b2, #06b6d4); }
        
        .season-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .estive { background: #fef3c7; color: #92400e; }
        .invernali { background: #dbeafe; color: #1e40af; }
        .quattro-stagioni { background: #d1fae5; color: #065f46; }
        
        .speed-code {
            display: inline-block;
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            font-weight: bold;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .firebase-status {
            transition: all 0.3s ease;
        }
        
        .firebase-connecting {
            animation: pulse 1.5s infinite;
        }
        
        .firebase-connected {
            animation: none;
        }
        
        .firebase-error {
            animation: pulse 2s infinite;
        }
        
        /* Responsive design */
        @media screen and (max-width: 768px) {
            .max-w-7xl {
                padding-left: 12px;
                padding-right: 12px;
            }
            
            .grid-cols-1.md\\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            table {
                min-width: 800px;
                font-size: 14px;
            }
            
            .modal-content {
                margin: 20px;
                max-height: calc(100vh - 40px);
                width: calc(100% - 40px);
            }
        }
        
        /* GitHub Pages deployment indicator */
        .deployment-badge {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #24292e, #586069);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        
        .deployment-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row md:justify-between md:items-center py-4 space-y-3 md:space-y-0">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-lg">🛞</span>
                    </div>
                    <div>
                        <h1 class="text-lg md:text-xl font-bold text-gray-900">Gestionale Pneumatici</h1>
                        <p class="text-xs md:text-sm text-gray-500">Sistema gratuito con Firebase + GitHub Pages</p>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-4">
                    <!-- Firebase Status -->
                    <div class="flex items-center space-x-2 text-xs md:text-sm">
                        <div id="firebaseStatus" class="firebase-status">
                            <div class="w-3 h-3 bg-yellow-500 rounded-full firebase-connecting"></div>
                        </div>
                        <div>
                            <div class="text-gray-900 font-medium" id="firebaseStatusText">Connessione Firebase...</div>
                            <div class="text-gray-500 text-xs" id="firebaseDetails">Inizializzazione</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 text-xs md:text-sm">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-gray-600">Online: <span id="onlineUsers">1</span> utente</span>
                    </div>
                    <button onclick="openAddModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 md:px-4 py-2 rounded-lg flex items-center justify-center space-x-2 text-sm md:text-base w-full md:w-auto">
                        <span>➕</span>
                        <span class="hidden sm:inline">Aggiungi Pneumatico</span>
                        <span class="sm:hidden">Aggiungi</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Firebase Connection Alert -->
    <div id="firebaseAlert" class="hidden bg-blue-50 border-l-4 border-blue-400 p-4">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <span class="text-blue-400 text-xl">🔥</span>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-blue-700">
                        <span class="font-medium">Firebase connesso!</span>
                        I tuoi dati sono sincronizzati in tempo reale e accessibili da qualsiasi dispositivo.
                        <a href="#" onclick="showFirebaseInfo()" class="underline hover:text-blue-900">Scopri di più</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-blue-100 rounded-lg">
                        <span class="text-blue-600 text-xl">📦</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Totale Pneumatici</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalTires">0</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-green-100 rounded-lg">
                        <span class="text-green-600 text-xl">✅</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Disponibili</p>
                        <p class="text-2xl font-bold text-gray-900" id="availableTires">0</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-yellow-100 rounded-lg">
                        <span class="text-yellow-600 text-xl">⚠️</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Scorte Basse</p>
                        <p class="text-2xl font-bold text-gray-900" id="lowStockTires">0</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-2 bg-purple-100 rounded-lg">
                        <span class="text-purple-600 text-xl">🏷️</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Marche</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalBrands">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Filtri di Ricerca</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Marca</label>
                    <select id="filterBrand" onchange="filterTires()" class="w-full p-3 border border-gray-300 rounded-lg">
                        <option value="">Tutte le marche</option>
                        <option value="Michelin">Michelin</option>
                        <option value="Riken">Riken</option>
                        <option value="Falken">Falken</option>
                        <option value="Sailun">Sailun</option>
                        <option value="Continental">Continental</option>
                        <option value="Pirelli">Pirelli</option>
                        <option value="Bridgestone">Bridgestone</option>
                        <option value="Goodyear">Goodyear</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Stagione</label>
                    <select id="filterSeason" onchange="filterTires()" class="w-full p-3 border border-gray-300 rounded-lg">
                        <option value="">Tutte le stagioni</option>
                        <option value="Estive">Estive</option>
                        <option value="Invernali">Invernali</option>
                        <option value="Quattro Stagioni">Quattro Stagioni</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Misura</label>
                    <input type="text" id="filterSize" onkeyup="filterTires()" placeholder="es. 205/55R16" class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ricerca</label>
                    <input type="text" id="searchInput" onkeyup="filterTires()" placeholder="Cerca per modello..." class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
            </div>
        </div>

        <!-- Free Hosting Info -->
        <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg shadow p-6 mb-6 border border-green-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-green-100 rounded-lg">
                        <span class="text-green-600 text-xl">🆓</span>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Hosting Gratuito Attivo</h3>
                        <p class="text-sm text-gray-600">
                            <span class="font-medium text-green-600">GitHub Pages</span> + 
                            <span class="font-medium text-blue-600">Firebase</span> - 
                            Sempre online, sempre gratis!
                        </p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button onclick="showDeploymentGuide()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm">
                        📚 Guida Deploy
                    </button>
                    <button onclick="shareApp()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm">
                        🔗 Condividi App
                    </button>
                </div>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Attività Recenti</h3>
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-sm text-gray-600">Sync in tempo reale</span>
                </div>
            </div>
            <div id="activityLog" class="space-y-3 max-h-48 overflow-y-auto">
                <!-- Activity items will be populated here -->
            </div>
        </div>

        <!-- Inventory Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="px-4 md:px-6 py-4 border-b border-gray-200">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center space-y-2 md:space-y-0">
                    <h3 class="text-lg font-semibold text-gray-900">Inventario Pneumatici</h3>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2 text-xs md:text-sm">
                            <span class="text-gray-500">Ultimo sync:</span>
                            <span class="font-medium text-green-600" id="lastSync">ora</span>
                        </div>
                        <button onclick="manualSync()" class="flex items-center space-x-1 px-3 py-1 text-blue-600 hover:text-blue-800 border border-blue-200 rounded-lg hover:bg-blue-50 text-sm">
                            <span id="syncIcon">🔄</span>
                            <span>Sync</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Marca</th>
                            <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modello</th>
                            <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Misura</th>
                            <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stagione</th>
                            <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Velocità</th>
                            <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantità</th>
                            <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prezzo</th>
                            <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Azioni</th>
                        </tr>
                    </thead>
                    <tbody id="tiresTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Tire entries will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="tireModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modalTitle" class="text-xl font-bold text-gray-900">Aggiungi Pneumatico</h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <form id="tireForm" onsubmit="saveTire(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Marca *</label>
                        <select id="brand" required class="w-full p-3 border border-gray-300 rounded-lg">
                            <option value="">Seleziona marca</option>
                            <option value="Michelin">Michelin</option>
                            <option value="Riken">Riken</option>
                            <option value="Falken">Falken</option>
                            <option value="Sailun">Sailun</option>
                            <option value="Continental">Continental</option>
                            <option value="Pirelli">Pirelli</option>
                            <option value="Bridgestone">Bridgestone</option>
                            <option value="Goodyear">Goodyear</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Modello *</label>
                        <input type="text" id="model" required placeholder="es. Pilot Sport 4" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Larghezza *</label>
                        <input type="number" id="width" required placeholder="205" min="125" max="355" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Altezza *</label>
                        <input type="number" id="height" required placeholder="55" min="25" max="85" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Diametro *</label>
                        <input type="number" id="diameter" required placeholder="16" min="13" max="24" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Stagione *</label>
                        <select id="season" required class="w-full p-3 border border-gray-300 rounded-lg">
                            <option value="">Seleziona stagione</option>
                            <option value="Estive">Estive</option>
                            <option value="Invernali">Invernali</option>
                            <option value="Quattro Stagioni">Quattro Stagioni</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Codice Velocità *</label>
                        <select id="speedCode" required class="w-full p-3 border border-gray-300 rounded-lg">
                            <option value="">Seleziona codice</option>
                            <option value="H">H (210 km/h)</option>
                            <option value="V">V (240 km/h)</option>
                            <option value="W">W (270 km/h)</option>
                            <option value="Y">Y (300 km/h)</option>
                            <option value="T">T (190 km/h)</option>
                            <option value="S">S (180 km/h)</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Quantità *</label>
                        <input type="number" id="quantity" required placeholder="4" min="0" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Prezzo (€) *</label>
                        <input type="number" id="price" required placeholder="120.00" step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Annulla
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Salva Pneumatico
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Area -->
    <div id="notificationArea" class="fixed top-4 right-4 z-50 space-y-2">
        <!-- Notifications will appear here -->
    </div>

    <!-- GitHub Pages Deployment Badge -->
    <div class="deployment-badge">
        <div class="flex items-center space-x-2">
            <span>🚀</span>
            <span>Hosted on GitHub Pages</span>
        </div>
    </div>

    <script>
        let tires = [];
        let editingIndex = -1;
        let activityLog = [];
        let firebaseConnected = false;
        let currentUser = null;

        // Firebase connection management
        async function initializeFirebase() {
            try {
                updateFirebaseStatus('connecting', 'Connessione Firebase...', 'Autenticazione in corso');
                
                // Authenticate anonymously
                const user = await window.authFunctions.signInAnonymously(window.firebaseAuth);
                currentUser = user.user;
                
                // Set up real-time listeners
                setupFirebaseListeners();
                
                // Load existing data
                await loadDataFromFirebase();
                
                firebaseConnected = true;
                updateFirebaseStatus('connected', 'Firebase Connesso', 'Sincronizzazione in tempo reale attiva');
                showFirebaseAlert();
                showNotification('🔥 Firebase connesso! Dati sincronizzati in tempo reale', 'success');
                
            } catch (error) {
                console.error('Errore Firebase:', error);
                updateFirebaseStatus('error', 'Errore Firebase', 'Modalità offline attiva');
                showNotification('⚠️ Modalità offline - I dati saranno salvati localmente', 'warning');
                loadFromLocalStorage();
            }
        }

        function updateFirebaseStatus(status, message, details) {
            const statusElement = document.getElementById('firebaseStatus');
            const textElement = document.getElementById('firebaseStatusText');
            const detailsElement = document.getElementById('firebaseDetails');
            
            statusElement.className = 'firebase-status';
            
            switch(status) {
                case 'connected':
                    statusElement.innerHTML = '<div class="w-3 h-3 bg-green-500 rounded-full firebase-connected"></div>';
                    statusElement.classList.add('firebase-connected');
                    textElement.textContent = message;
                    detailsElement.textContent = details;
                    break;
                    
                case 'connecting':
                    statusElement.innerHTML = '<div class="w-3 h-3 bg-yellow-500 rounded-full firebase-connecting"></div>';
                    statusElement.classList.add('firebase-connecting');
                    textElement.textContent = message;
                    detailsElement.textContent = details;
                    break;
                    
                case 'error':
                    statusElement.innerHTML = '<div class="w-3 h-3 bg-red-500 rounded-full firebase-error"></div>';
                    statusElement.classList.add('firebase-error');
                    textElement.textContent = message;
                    detailsElement.textContent = details;
                    break;
            }
        }

        function showFirebaseAlert() {
            document.getElementById('firebaseAlert').classList.remove('hidden');
        }

        function setupFirebaseListeners() {
            // Listen for tire changes
            const tiresRef = window.firebaseRefs.ref(window.firebaseDB, 'tires');
            window.firebaseRefs.onValue(tiresRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    syncTiresFromFirebase(data);
                }
            });

            // Listen for activity changes
            const activityRef = window.firebaseRefs.ref(window.firebaseDB, 'activity');
            window.firebaseRefs.onValue(activityRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    syncActivityFromFirebase(data);
                }
            });
        }

        async function loadDataFromFirebase() {
            try {
                // Load tires
                const tiresSnapshot = await window.firebaseRefs.get(window.firebaseRefs.ref(window.firebaseDB, 'tires'));
                if (tiresSnapshot.exists()) {
                    const tiresData = tiresSnapshot.val();
                    tires = Object.values(tiresData).map(tire => ({
                        ...tire,
                        lastModified: new Date(tire.lastModified)
                    }));
                }

                // Load activity
                const activitySnapshot = await window.firebaseRefs.get(window.firebaseRefs.ref(window.firebaseDB, 'activity'));
                if (activitySnapshot.exists()) {
                    const activityData = activitySnapshot.val();
                    activityLog = Object.values(activityData)
                        .map(activity => ({
                            ...activity,
                            timestamp: new Date(activity.timestamp)
                        }))
                        .sort((a, b) => b.timestamp - a.timestamp)
                        .slice(0, 50);
                }

                updateDisplay();
                updateActivityLog();
                
            } catch (error) {
                console.error('Errore caricamento da Firebase:', error);
                loadFromLocalStorage();
            }
        }

        function syncTiresFromFirebase(firebaseData) {
            let hasChanges = false;
            const newTires = Object.values(firebaseData).map(tire => ({
                ...tire,
                lastModified: new Date(tire.lastModified)
            }));

            // Simple replacement for real-time sync
            if (JSON.stringify(tires) !== JSON.stringify(newTires)) {
                tires = newTires;
                hasChanges = true;
            }

            if (hasChanges) {
                updateDisplay();
                document.getElementById('lastSync').textContent = 'ora';
            }
        }

        function syncActivityFromFirebase(firebaseData) {
            const newActivity = Object.values(firebaseData)
                .map(activity => ({
                    ...activity,
                    timestamp: new Date(activity.timestamp)
                }))
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 50);

            if (JSON.stringify(activityLog) !== JSON.stringify(newActivity)) {
                activityLog = newActivity;
                updateActivityLog();
            }
        }

        async function saveToFirebase(path, data) {
            if (!firebaseConnected) {
                saveToLocalStorage();
                return;
            }

            try {
                await window.firebaseRefs.set(window.firebaseRefs.ref(window.firebaseDB, path), data);
                document.getElementById('lastSync').textContent = 'ora';
            } catch (error) {
                console.error('Errore salvataggio Firebase:', error);
                showNotification('⚠️ Errore sincronizzazione - Salvato localmente', 'warning');
                saveToLocalStorage();
            }
        }

        function saveToLocalStorage() {
            try {
                const data = {
                    tires: tires,
                    activityLog: activityLog.slice(0, 20),
                    lastSave: new Date().toISOString()
                };
                localStorage.setItem('pneumaticiData', JSON.stringify(data));
            } catch (error) {
                console.error('Errore salvataggio locale:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('pneumaticiData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    if (data.tires) {
                        tires = data.tires.map(tire => ({
                            ...tire,
                            lastModified: new Date(tire.lastModified)
                        }));
                    }
                    
                    if (data.activityLog) {
                        activityLog = data.activityLog.map(activity => ({
                            ...activity,
                            timestamp: new Date(activity.timestamp)
                        }));
                    }
                    
                    updateDisplay();
                    updateActivityLog();
                    showNotification('📂 Dati caricati dal storage locale', 'info');
                }
            } catch (error) {
                console.error('Errore caricamento locale:', error);
                initializeSampleData();
            }
        }

        function initializeSampleData() {
            if (tires.length === 0) {
                tires = [
                    {
                        id: Date.now() + 1,
                        brand: 'Michelin',
                        model: 'Pilot Sport 4',
                        width: 205,
                        height: 55,
                        diameter: 16,
                        season: 'Estive',
                        speedCode: 'V',
                        quantity: 8,
                        price: 145.50,
                        lastModified: new Date(),
                        modifiedBy: 'Sistema'
                    },
                    {
                        id: Date.now() + 2,
                        brand: 'Continental',
                        model: 'WinterContact TS 860',
                        width: 225,
                        height: 45,
                        diameter: 17,
                        season: 'Invernali',
                        speedCode: 'H',
                        quantity: 4,
                        price: 132.00,
                        lastModified: new Date(Date.now() - 300000),
                        modifiedBy: 'Sistema'
                    }
                ];

                activityLog = [
                    {
                        id: Date.now() + 1,
                        user: 'Sistema',
                        action: 'ha inizializzato',
                        item: 'Gestionale Pneumatici',
                        details: 'Dati di esempio caricati',
                        timestamp: new Date(),
                        type: 'system'
                    }
                ];

                updateDisplay();
                updateActivityLog();
            }
        }

        // UI Functions
        function openAddModal() {
            editingIndex = -1;
            document.getElementById('modalTitle').textContent = 'Aggiungi Pneumatico';
            document.getElementById('tireForm').reset();
            document.getElementById('tireModal').classList.add('show');
        }

        function openEditModal(index) {
            editingIndex = index;
            const tire = tires[index];
            document.getElementById('modalTitle').textContent = 'Modifica Pneumatico';
            
            document.getElementById('brand').value = tire.brand;
            document.getElementById('model').value = tire.model;
            document.getElementById('width').value = tire.width;
            document.getElementById('height').value = tire.height;
            document.getElementById('diameter').value = tire.diameter;
            document.getElementById('season').value = tire.season;
            document.getElementById('speedCode').value = tire.speedCode;
            document.getElementById('quantity').value = tire.quantity;
            document.getElementById('price').value = tire.price;
            
            document.getElementById('tireModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('tireModal').classList.remove('show');
        }

        async function saveTire(event) {
            event.preventDefault();
            
            const tire = {
                id: editingIndex >= 0 ? tires[editingIndex].id : Date.now(),
                brand: document.getElementById('brand').value,
                model: document.getElementById('model').value,
                width: parseInt(document.getElementById('width').value),
                height: parseInt(document.getElementById('height').value),
                diameter: parseInt(document.getElementById('diameter').value),
                season: document.getElementById('season').value,
                speedCode: document.getElementById('speedCode').value,
                quantity: parseInt(document.getElementById('quantity').value),
                price: parseFloat(document.getElementById('price').value),
                lastModified: new Date(),
                modifiedBy: currentUser ? 'Tu' : 'Utente'
            };

            const tireDescription = `${tire.brand} ${tire.model} ${tire.width}/${tire.height}R${tire.diameter}`;
            
            if (editingIndex >= 0) {
                tires[editingIndex] = tire;
                addActivity('Tu', 'hai modificato', tireDescription, 'aggiornamento dati', 'edit');
                showNotification(`Pneumatico modificato: ${tireDescription}`, 'success');
            } else {
                tires.push(tire);
                addActivity('Tu', 'hai aggiunto', tireDescription, `${tire.quantity} pezzi`, 'add');
                showNotification(`Nuovo pneumatico aggiunto: ${tireDescription}`, 'success');
            }

            updateDisplay();
            updateActivityLog();
            closeModal();
            
            // Save to Firebase
            if (firebaseConnected) {
                const tiresData = {};
                tires.forEach(t => {
                    tiresData[t.id] = { ...t, lastModified: t.lastModified.toISOString() };
                });
                await saveToFirebase('tires', tiresData);
            } else {
                saveToLocalStorage();
            }
        }

        function deleteTire(index) {
            if (confirm('Sei sicuro di voler eliminare questo pneumatico?')) {
                const tire = tires[index];
                const tireDescription = `${tire.brand} ${tire.model} ${tire.width}/${tire.height}R${tire.diameter}`;
                
                tires.splice(index, 1);
                addActivity('Tu', 'hai eliminato', tireDescription, 'rimosso dall\'inventario', 'delete');
                
                updateDisplay();
                updateActivityLog();
                showNotification(`Pneumatico eliminato: ${tireDescription}`, 'info');
                
                // Save to Firebase
                if (firebaseConnected) {
                    const tiresData = {};
                    tires.forEach(t => {
                        tiresData[t.id] = { ...t, lastModified: t.lastModified.toISOString() };
                    });
                    saveToFirebase('tires', tiresData);
                } else {
                    saveToLocalStorage();
                }
            }
        }

        async function updateQuantity(index, change) {
            const newQuantity = tires[index].quantity + change;
            if (newQuantity >= 0) {
                const oldQuantity = tires[index].quantity;
                tires[index].quantity = newQuantity;
                tires[index].lastModified = new Date();
                tires[index].modifiedBy = 'Tu';
                
                const tireDescription = `${tires[index].brand} ${tires[index].model}`;
                addActivity('Tu', 'hai modificato la quantità', tireDescription, `da ${oldQuantity} a ${newQuantity} pezzi`, 'quantity');
                
                updateDisplay();
                updateActivityLog();
                
                if (newQuantity <= 3 && oldQuantity > 3) {
                    showNotification(`⚠️ Scorte basse per ${tireDescription}`, 'warning');
                }
                
                // Save to Firebase
                if (firebaseConnected) {
                    const tiresData = {};
                    tires.forEach(t => {
                        tiresData[t.id] = { ...t, lastModified: t.lastModified.toISOString() };
                    });
                    await saveToFirebase('tires', tiresData);
                } else {
                    saveToLocalStorage();
                }
            }
        }

        function addActivity(user, action, item, details, type) {
            const activity = {
                id: Date.now(),
                user,
                action,
                item,
                details,
                timestamp: new Date(),
                type
            };
            
            activityLog.unshift(activity);
            
            // Keep only last 50 activities
            if (activityLog.length > 50) {
                activityLog = activityLog.slice(0, 50);
            }
            
            // Save to Firebase
            if (firebaseConnected) {
                const activityData = {};
                activityLog.forEach(a => {
                    activityData[a.id] = { ...a, timestamp: a.timestamp.toISOString() };
                });
                saveToFirebase('activity', activityData);
            }
        }

        function updateActivityLog() {
            const container = document.getElementById('activityLog');
            const activitiesToShow = activityLog.slice(0, 10);
            
            if (activitiesToShow.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">Nessuna attività recente</p>';
                return;
            }
            
            container.innerHTML = activitiesToShow.map(activity => {
                const timeAgo = getTimeAgo(activity.timestamp);
                const iconMap = {
                    'add': '➕',
                    'edit': '✏️',
                    'quantity': '📦',
                    'delete': '🗑️',
                    'system': '⚙️'
                };
                
                return `
                    <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                        <span class="text-lg">${iconMap[activity.type] || '📝'}</span>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm text-gray-900">
                                <span class="font-medium">${activity.user}</span> ${activity.action}
                                <span class="font-medium">${activity.item}</span>
                            </p>
                            <p class="text-xs text-gray-500">${activity.details}</p>
                            <p class="text-xs text-gray-400 mt-1">${timeAgo}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'ora';
            if (diffInMinutes < 60) return `${diffInMinutes} min fa`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `${diffInHours}h fa`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            return `${diffInDays}g fa`;
        }

        function getBrandClass(brand) {
            return brand.toLowerCase().replace(/\s+/g, '');
        }

        function getSeasonClass(season) {
            return season.toLowerCase().replace(/\s+/g, '-');
        }

        function updateStats() {
            const total = tires.length;
            const available = tires.filter(tire => tire.quantity > 0).length;
            const lowStock = tires.filter(tire => tire.quantity > 0 && tire.quantity <= 3).length;
            const brands = new Set(tires.map(tire => tire.brand)).size;

            document.getElementById('totalTires').textContent = total;
            document.getElementById('availableTires').textContent = available;
            document.getElementById('lowStockTires').textContent = lowStock;
            document.getElementById('totalBrands').textContent = brands;
        }

        function renderTiresTable(tiresToRender = tires) {
            const tbody = document.getElementById('tiresTableBody');
            
            if (tiresToRender.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                            <div class="flex flex-col items-center">
                                <span class="text-4xl mb-2">🔍</span>
                                <p>Nessun pneumatico trovato</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = tiresToRender.map((tire, index) => {
                const originalIndex = tires.indexOf(tire);
                const stockStatus = tire.quantity === 0 ? 'text-red-600' : tire.quantity <= 3 ? 'text-yellow-600' : 'text-green-600';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="brand-logo ${getBrandClass(tire.brand)}">
                                    ${tire.brand.substring(0, 3).toUpperCase()}
                                </div>
                                <span class="ml-2 md:ml-3 text-xs md:text-sm font-medium text-gray-900">${tire.brand}</span>
                            </div>
                        </td>
                        <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap text-xs md:text-sm text-gray-900">${tire.model}</td>
                        <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap text-xs md:text-sm font-mono text-gray-900">${tire.width}/${tire.height}R${tire.diameter}</td>
                        <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap">
                            <span class="season-badge ${getSeasonClass(tire.season)}">${tire.season}</span>
                        </td>
                        <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap">
                            <span class="speed-code">${tire.speedCode}</span>
                        </td>
                        <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap">
                            <div class="flex items-center space-x-1 md:space-x-2">
                                <button onclick="updateQuantity(${originalIndex}, -1)" class="w-6 h-6 bg-red-100 text-red-600 rounded hover:bg-red-200 flex items-center justify-center text-xs md:text-sm">-</button>
                                <span class="text-xs md:text-sm font-medium ${stockStatus} min-w-[1.5rem] md:min-w-[2rem] text-center">${tire.quantity}</span>
                                <button onclick="updateQuantity(${originalIndex}, 1)" class="w-6 h-6 bg-green-100 text-green-600 rounded hover:bg-green-200 flex items-center justify-center text-xs md:text-sm">+</button>
                            </div>
                        </td>
                        <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap text-xs md:text-sm font-medium text-gray-900">€${tire.price.toFixed(2)}</td>
                        <td class="px-3 md:px-6 py-2 md:py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-1 md:space-x-2">
                                <button onclick="openEditModal(${originalIndex})" class="text-blue-600 hover:text-blue-900 text-lg md:text-base">✏️</button>
                                <button onclick="deleteTire(${originalIndex})" class="text-red-600 hover:text-red-900 text-lg md:text-base">🗑️</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterTires() {
            const brandFilter = document.getElementById('filterBrand').value.toLowerCase();
            const seasonFilter = document.getElementById('filterSeason').value.toLowerCase();
            const sizeFilter = document.getElementById('filterSize').value.toLowerCase();
            const searchFilter = document.getElementById('searchInput').value.toLowerCase();

            const filtered = tires.filter(tire => {
                const matchesBrand = !brandFilter || tire.brand.toLowerCase().includes(brandFilter);
                const matchesSeason = !seasonFilter || tire.season.toLowerCase().includes(seasonFilter);
                const tireSize = `${tire.width}/${tire.height}r${tire.diameter}`;
                const matchesSize = !sizeFilter || tireSize.includes(sizeFilter);
                const matchesSearch = !searchFilter || tire.model.toLowerCase().includes(searchFilter);

                return matchesBrand && matchesSeason && matchesSize && matchesSearch;
            });

            renderTiresTable(filtered);
        }

        function updateDisplay() {
            updateStats();
            renderTiresTable();
        }

        async function manualSync() {
            const syncIcon = document.getElementById('syncIcon');
            syncIcon.style.animation = 'spin 1s linear infinite';
            
            if (firebaseConnected) {
                try {
                    // Save current data to Firebase
                    const tiresData = {};
                    tires.forEach(t => {
                        tiresData[t.id] = { ...t, lastModified: t.lastModified.toISOString() };
                    });
                    await saveToFirebase('tires', tiresData);
                    
                    const activityData = {};
                    activityLog.forEach(a => {
                        activityData[a.id] = { ...a, timestamp: a.timestamp.toISOString() };
                    });
                    await saveToFirebase('activity', activityData);
                    
                    showNotification('🔄 Sincronizzazione completata!', 'success');
                } catch (error) {
                    showNotification('❌ Errore sincronizzazione', 'error');
                }
            } else {
                saveToLocalStorage();
                showNotification('💾 Dati salvati localmente', 'info');
            }
            
            setTimeout(() => {
                syncIcon.style.animation = '';
            }, 1000);
        }

        function showNotification(message, type = 'info') {
            const notificationArea = document.getElementById('notificationArea');
            const notification = document.createElement('div');
            
            const colors = {
                'success': 'bg-green-500',
                'warning': 'bg-yellow-500',
                'error': 'bg-red-500',
                'info': 'bg-blue-500'
            };
            
            notification.className = `${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-3 text-white hover:text-gray-200">×</button>
                </div>
            `;
            
            notificationArea.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        function showFirebaseInfo() {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">🔥 Firebase + GitHub Pages</h2>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h3 class="font-semibold text-green-800 mb-2">✅ Vantaggi della Soluzione Gratuita</h3>
                            <ul class="text-sm text-green-700 space-y-1">
                                <li>• <strong>Firebase Realtime Database</strong> - Sincronizzazione in tempo reale</li>
                                <li>• <strong>GitHub Pages</strong> - Hosting gratuito e affidabile</li>
                                <li>• <strong>Nessun costo</strong> - Piano Spark Firebase gratuito</li>
                                <li>• <strong>Accessibile ovunque</strong> - Funziona su tutti i dispositivi</li>
                                <li>• <strong>Backup automatico</strong> - I dati sono sempre al sicuro</li>
                            </ul>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h3 class="font-semibold text-blue-800 mb-2">🚀 Come Funziona</h3>
                            <ol class="text-sm text-blue-700 space-y-1">
                                <li>1. <strong>GitHub Pages</strong> ospita l'applicazione gratuitamente</li>
                                <li>2. <strong>Firebase</strong> gestisce il database in tempo reale</li>
                                <li>3. <strong>Autenticazione anonima</strong> per accesso immediato</li>
                                <li>4. <strong>Fallback locale</strong> se Firebase non è disponibile</li>
                            </ol>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h3 class="font-semibold text-yellow-800 mb-2">📊 Limiti Piano Gratuito</h3>
                            <ul class="text-sm text-yellow-700 space-y-1">
                                <li>• <strong>1GB storage</strong> - Sufficiente per migliaia di pneumatici</li>
                                <li>• <strong>10GB/mese transfer</strong> - Ottimo per uso aziendale</li>
                                <li>• <strong>100 connessioni simultanee</strong> - Perfetto per team</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="flex justify-end mt-6">
                        <button onclick="this.closest('.modal').remove()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Perfetto!
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showDeploymentGuide() {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">📚 Guida Deploy Gratuito</h2>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <h3 class="font-semibold text-gray-900 mb-3">🔥 1. Setup Firebase (Gratuito)</h3>
                            <ol class="text-sm text-gray-700 space-y-2 ml-4">
                                <li>1. Vai su <a href="https://console.firebase.google.com" target="_blank" class="text-blue-600 underline">Firebase Console</a></li>
                                <li>2. Crea nuovo progetto (gratis)</li>
                                <li>3. Abilita "Realtime Database"</li>
                                <li>4. Imposta regole: <code class="bg-gray-100 px-1 rounded">{"rules": {".read": true, ".write": true}}</code></li>
                                <li>5. Copia la configurazione nel codice</li>
                            </ol>
                        </div>
                        
                        <div>
                            <h3 class="font-semibold text-gray-900 mb-3">🐙 2. Deploy su GitHub Pages</h3>
                            <ol class="text-sm text-gray-700 space-y-2 ml-4">
                                <li>1. Crea repository GitHub pubblico</li>
                                <li>2. Carica il file HTML</li>
                                <li>3. Vai in Settings → Pages</li>
                                <li>4. Seleziona "Deploy from branch: main"</li>
                                <li>5. Il tuo sito sarà su: <code class="bg-gray-100 px-1 rounded">username.github.io/repo-name</code></li>
                            </ol>
                        </div>
                        
                        <div>
                            <h3 class="font-semibold text-gray-900 mb-3">⚙️ 3. Configurazione</h3>
                            <ul class="text-sm text-gray-700 space-y-1 ml-4">
                                <li>• Sostituisci la config Firebase con la tua</li>
                                <li>• Personalizza il nome dell'app</li>
                                <li>• Aggiungi il tuo dominio (opzionale)</li>
                            </ul>
                        </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800 mb-2">🎉 Risultato</h4>
                            <p class="text-sm text-green-700">
                                Avrai un gestionale pneumatici professionale, gratuito, sempre online e accessibile da qualsiasi dispositivo!
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end mt-6">
                        <button onclick="this.closest('.modal').remove()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            Iniziamo!
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function shareApp() {
            const url = window.location.href;
            const text = 'Gestionale Pneumatici - Sistema gratuito con Firebase e GitHub Pages';
            
            if (navigator.share) {
                navigator.share({
                    title: 'Gestionale Pneumatici',
                    text: text,
                    url: url
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(`${text}\n${url}`).then(() => {
                    showNotification('🔗 Link copiato negli appunti!', 'success');
                });
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeSampleData();
            initializeFirebase();
        });

        // Close modals when clicking outside
        document.getElementById('tireModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c85fe3c1cfea63',t:'MTc1NDc1NDI2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
